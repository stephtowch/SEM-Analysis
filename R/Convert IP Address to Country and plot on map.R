#Convert IP addresses and plot on a map
#load the data set
options(scipen = 999)
options(max.print = 1000000)
data = readr::read_csv("C:/Users/Steph/Documents/ip_address.csv")
View(data)


################################IP_ADDRESS_PLOT#############################
df <- read.table(text="
ip_address
86.166.181.47
195.99.59.160
151.228.208.148
86.166.181.47
31.94.60.82
183.171.103.15
113.211.97.226
101.190.215.244
149.86.16.153
149.22.213.199
86.130.172.251
86.11.48.68
147.161.229.84
172.97.38.142
131.227.23.35
92.41.210.151
31.215.23.198
110.224.117.77
94.206.63.250
70.161.140.119
39.9.63.119
188.29.189.85
110.226.183.142
43.246.221.227
84.71.10.218
93.41.113.37
86.143.222.149
116.118.114.219
109.42.178.116
92.41.210.211
149.36.29.195
72.69.209.18
90.211.183.155
80.233.61.28
86.11.9.126
161.142.103.138
203.0.31.200
129.127.68.11
78.87.48.119
86.163.76.45
146.75.168.55
90.210.244.28
148.252.128.39
79.233.26.23
139.184.223.126
31.205.107.242
165.120.242.215
84.64.44.242
81.129.131.112
82.132.246.248
2.26.145.246
149.241.184.120
51.190.184.54
81.65.160.226
86.26.204.85
86.30.180.181
84.158.245.200
101.113.40.15
86.129.71.107
195.53.109.195
147.161.142.114
89.21.209.5
81.157.57.212
208.78.212.28
80.41.70.246
79.69.63.127
2.120.107.93
195.99.158.202
82.12.233.158
147.161.166.89
104.28.86.131
84.207.244.174
31.94.57.29
77.103.50.44
90.206.52.71
2.222.80.105
92.97.157.9
148.252.129.228
109.145.126.44
31.205.126.226
2.247.248.22
93.192.83.191
212.127.193.26
103.156.157.253
109.149.39.227
89.21.209.5
82.11.246.1
93.109.231.162
46.123.240.235
158.143.225.151
112.134.171.201
194.80.64.243
192.132.205.15
81.242.18.8
43.246.226.231
94.2.184.106
82.15.90.227
159.196.244.94
103.151.37.44
147.197.100.218
93.33.5.64
31.215.23.198
86.130.223.124
51.146.107.111
90.192.80.167
92.24.30.91
77.243.26.26
206.84.145.73
206.84.145.73
123.24.15.172
112.134.209.150
176.253.47.55
144.82.8.109
31.51.94.96
122.199.9.13
31.205.85.88
86.190.211.232
14.200.185.169
89.150.138.224
5.151.90.240
94.188.131.51
80.233.40.238
140.228.40.135
82.132.228.99
90.218.46.44
2.223.250.122
86.164.34.214
68.55.7.158
122.107.183.47
128.214.108.2
14.0.155.10
147.12.224.81
86.181.88.180
31.94.1.204
159.196.168.122
81.153.142.18
27.32.151.22
151.100.200.151
105.244.199.70
176.253.223.60
86.165.235.139
76.64.218.84
85.203.34.130
45.89.242.228
31.94.66.69
203.0.31.200
104.28.40.96
94.15.96.136
86.136.46.246
71.220.179.176
14.203.246.10
2.218.157.90
86.169.133.110
146.70.120.211
86.22.102.226
194.80.254.12
151.225.65.123
83.137.6.226
109.145.127.102
49.43.219.179
213.208.157.39
91.129.98.124
82.18.83.254
86.136.142.133
188.28.144.43
81.131.151.202
86.25.66.75
80.4.234.109
5.71.169.51
213.1.9.159
195.175.21.150
49.14.117.3
178.135.1.186
84.0.33.86
49.197.48.179
178.132.104.172
82.42.163.84
82.132.244.43
139.184.223.133
92.11.219.178
213.105.110.129
58.27.202.70
203.87.1.109
149.22.178.149
104.28.89.73
86.7.29.10
146.196.35.22
88.108.211.175
147.148.64.19
77.98.254.97
144.173.23.75
148.252.129.32
158.174.187.44
92.233.221.209
139.184.223.162
82.38.211.40
139.153.66.205
148.252.129.93
51.241.184.199
109.156.65.158
82.132.226.191
152.37.109.200
159.197.179.181
110.168.242.22
31.49.56.198
140.228.41.158
84.66.144.246
85.139.81.25
81.108.40.109
103.192.80.236
172.225.181.82
98.214.101.201
206.12.14.233
217.138.75.228
99.102.82.139
120.147.167.105
89.205.86.181
2.221.134.225
77.38.29.34
80.233.33.242
76.140.117.151
86.148.7.73
139.184.223.133
89.134.25.193
178.197.211.174
178.199.56.23
156.57.71.176
78.22.161.82
81.5.147.249
95.90.201.60
90.255.67.110
82.132.218.167
5.151.21.24
24.236.129.201
94.2.16.114
130.248.32.17
58.72.50.10
90.205.105.87
72.138.20.20
82.27.88.237
89.15.239.34
92.6.28.145
82.4.214.225
128.107.241.162
90.254.187.214
130.248.32.17
66.68.230.101
156.200.155.221
193.120.161.6
178.149.141.155
31.4.231.233
117.20.68.228
172.59.194.127
5.224.4.170
92.182.17.133
87.115.114.86
78.19.26.135
31.152.137.120
137.220.75.52
145.5.180.8
85.255.232.21
77.102.240.27
185.146.220.104
185.36.251.58
51.19.34.99
88.111.35.14
93.45.64.182
92.14.163.157
109.255.170.182
76.31.2.90
78.150.176.165
114.76.168.52
31.94.29.57
101.180.176.156
94.4.83.171
213.55.244.100
5.151.89.152
60.242.128.54
188.65.190.66
90.196.71.7
82.76.49.116
82.76.49.116
87.252.46.242
148.252.133.220
84.66.144.246
101.184.21.113
136.228.244.52
82.132.215.168
72.220.50.191
45.131.193.37
109.157.111.65
201.17.123.119
201.17.123.119
172.91.107.176
194.80.233.5
73.53.141.161
121.200.5.152
2.96.148.152
143.117.255.86
171.4.250.154
104.28.85.226
85.255.232.141
46.69.47.231
86.144.127.13
92.73.251.121
194.80.233.40
77.125.134.203
103.211.52.35
82.132.231.182
169.1.42.103
212.221.151.43
159.196.232.51
41.13.12.162
46.19.238.125
31.205.1.185
62.172.83.172
213.57.221.125
90.206.52.71
139.184.223.214
78.19.68.31
88.25.23.64
41.221.8.180
79.112.27.96
5.67.153.66
27.109.114.214
109.43.178.93
105.112.96.235
37.205.58.148
89.37.175.15
131.111.185.23
98.97.39.182
31.205.148.23
86.157.179.43
81.205.53.204
79.129.205.169
165.255.114.14
122.150.49.212
91.110.102.25
82.22.122.198
86.131.50.104
24.205.75.38
172.223.85.72
175.36.159.0
96.250.62.104
116.88.60.54
217.164.186.74
31.191.98.253
46.216.226.185
94.6.10.248
87.160.62.130
31.94.73.50
51.148.159.91
91.209.212.50
37.220.204.114
67.226.126.1
144.124.84.168
91.110.90.15
94.14.125.157
66.108.117.82
47.187.254.206
37.215.23.186
31.205.0.43
89.142.154.169
174.82.59.16
24.102.213.211
197.147.13.153
72.177.212.145
78.151.174.114
97.81.168.130
2.49.253.189
51.6.154.185
68.34.78.153
72.179.46.116
87.114.27.65
2.97.157.187
158.143.228.77
45.14.71.9
5.151.132.97
47.4.36.5
43.239.85.155
202.36.244.47
178.70.80.255
35.148.180.9
93.67.55.139
90.221.26.67
172.105.224.35
122.134.250.22
185.167.108.38
82.33.122.33
139.184.223.147
82.7.178.211
109.180.127.18
78.143.193.37
109.154.29.217
93.239.203.16
90.241.229.186
165.225.80.238
92.40.194.0
158.143.228.77
203.205.51.129
152.78.0.24
105.1.200.170
130.88.226.4
86.176.168.225
51.179.101.4
194.66.32.10
5.91.65.8
128.240.225.9
212.102.63.52
217.230.146.218
178.24.249.117
67.245.44.98
92.12.244.113
193.136.56.33
137.248.1.31
86.143.210.36
49.37.37.69
129.234.0.185
213.233.155.132
46.10.251.25
139.184.223.146
217.230.146.218
139.184.223.146
94.133.170.63
73.11.251.117
92.236.190.51
82.132.227.32
31.52.200.24
2.217.238.74
86.134.157.255
77.111.246.49
101.181.116.29
141.215.94.38
86.143.140.203
14.201.104.193
118.189.129.138
176.252.95.188
103.45.242.18
91.85.33.138
184.169.60.217
14.231.12.11
217.230.146.218
86.160.255.245
139.184.223.146
130.43.154.197
73.206.73.165
71.190.182.4
38.7.31.166
184.179.138.145
71.190.227.191
45.36.11.212
75.245.16.92
212.36.194.90
173.246.151.49
194.230.144.40
49.205.139.8
86.172.184.199
213.40.119.95
180.177.110.130
86.8.69.107
79.160.232.168
134.101.186.209
92.40.145.240
94.15.186.130
99.252.30.80
86.150.140.246
144.134.80.117
105.243.4.37
213.40.119.95
73.35.85.156
188.29.127.12
188.120.103.83
81.132.101.16
137.205.1.55
103.137.12.198
86.8.20.177
163.152.3.172
82.36.156.129
82.155.130.149
68.56.24.81
71.69.165.165
185.186.69.255
136.36.37.39
24.6.91.133
216.147.125.230
207.216.56.198
77.253.155.80
42.243.22.98
147.161.163.107
195.244.195.132
87.80.105.219
94.14.52.148
110.147.221.136
37.60.67.9
164.39.34.98
90.221.40.128
177.40.217.174
109.155.109.81
93.38.49.65
31.124.150.179
125.168.47.184
197.210.70.117
89.244.120.170
86.134.169.61
139.184.223.144
129.205.124.239
2.86.201.1
86.41.40.210
159.138.62.242
76.173.102.236
67.9.29.255
101.44.80.191
115.164.119.226
180.74.64.106
165.154.72.249", header = TRUE)
View(df)

#Load the package
pacman::p_load(ip2location, reticulate, tidyverse)

#load python
use_python('C:/Users/Steph/AppData/Local/Programs/Python/Python311/python.exe')

# load IP2Location bin file
ip2location::open("C:/Users/Steph/Documents/IP2LOCATION-LITE-DB11.BIN")
df <- df |>
  mutate(details =  map(ip_address, get_all)) |> 
  unnest_wider(details) 
#df
print(df,n=500)#change n value
write.csv(df, "C:/Users/Steph/Documents/df_IPaddresses.csv", row.names = FALSE)

#plot on map
plot_map(df$ip_address)

##############REVIEW CODE TO EXPORT DATA###############################

export.df <- data.frame(df$IP.Address, df$country_long)
colnames(export.df) <- c("IP Address", "Country")
write.csv(export.df, "C:/Users/Steph/Documents/IP_to_Location.csv")




